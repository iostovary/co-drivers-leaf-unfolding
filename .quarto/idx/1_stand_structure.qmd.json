{"title":"Stand structure","markdown":{"yaml":{"editor":{"markdown":{"wrap":72}},"editor_options":{"chunk_output_type":"inline"}},"headingText":"Stand structure","containsRefs":false,"markdown":"\n\n\n```{r}\nlocation <- paste0(getwd())\nsource(paste0(\"../00_helpers/setup.R\")) #common libraries and custom functions\nsource(paste0(\"../00_helpers/species_and_phases.R\"))\nsample_data <- readRDS(paste0(path_own_data, \"/sample_data.rds\"))\nsample_comp <- readRDS(paste0(path_own_data, \"/sample_competition.rds\"))\n```\n\n## Data collection\n\nAll tree height, distance to observation tree and distance to forest edge were measured as horizontal distance with a\nHaglöf Vertex IV.\n\n## Competition\n\nAll trees within a radius of 10m from the center tree and a DBH \\>=14cm\nwhere considered as competitors. Some observation trees were very thin (see @tbl-competition-special-cases) in which case all competitors that were of the same diameter as the observation tree were recorded as well.\nSample plots where often not entirely within the forest,\nbecause the sample tree stood at the forest edge or close to a forest\nroad. Furthermore, often groups of trees instead of individual trees\nwere observed. Also, information given by the observers indicated a\nlot of intervention, e.g. clean up of wind throws or harvesting, in recent years that I was unable to assess\nsystematically. The Hegyi and Schroeder competition index as well as basal area were calculated, but their values are mathematically flawed and misleading. Therefore, we only used social situation and edge distance to account for stand climate.\n\n```{r tbl-competition-special-cases}\n# tbl-cap: SPN trees with small (<20 cm) or very small (<14 cm) diameters.\ntable <- sample_data %>% \n  filter(DBH_single <=20) %>%\n  select(METEO_ID, SPECIES_TREE, DBH_single) %>%\n  arrange(DBH_single) %>%\n  datatable(rownames = FALSE, options = list(scrollX = FALSE, pageLength = 5))\ntable\n```\n\n## Edge distance\n\nEdge distance was measured as distance from trunk of the observation tree to crown edge at the forest edge. Trees outside of the forest were assigned an edge distance of -5m. Trees\nthat exceeded the measuring distance of the vertex (approximately > 45m)\nwere assigned 50m. These special cases were flagged with a variable indicating a measurement or an imputed\nvalue. This would ensure that trees with imputed values have separate\nslopes and do not pull the slope of actually measured trees. E.g.\ndoy \\~ edge_distance * edge_distance_imputed + topography +\nelevation.\n\n```{r competition-all, filename=\"Calculation of competition parameters.\", include=TRUE, echo=TRUE}\n#| code-fold: true\n\ncompetition <- sample_comp %>%\n  full_join(sample_data %>% select(SAMPLE_CODE, OBSERVATION_TYPE), by=c(\"SAMPLE_CODE\")) %>% \n  group_by(SAMPLE_CODE, OBSERVATION_TYPE) %>%\n  nest() %>%\n  ungroup() %>% \n  as.data.frame() %>%\n  mutate(NUMBER_OF_TREES = map(data, ~.x %>%\n                                 summarise(NUMBER_OF_TREES = n())),\n         STAND_HEIGHT = map(data, ~.x %>%\n                       arrange(desc(HEIGHT)) %>%\n                       slice_head(n=3) %>% \n                       summarise(STAND_HEIGHT=mean(HEIGHT)) %>% \n                       mutate(STAND_HEIGHT=case_when(is.na(STAND_HEIGHT) ~ 0,\n                                                     TRUE ~ STAND_HEIGHT)))) %>%\n  #NUMBER OF DOMINANT SPECIES\n  mutate(SPECIES_DOM = map(data, ~.x %>%\n                      arrange(desc(HEIGHT)) %>%\n                      slice_head(n=5) %>%\n                      summarise(SPECIES_DOM=n_distinct(SPECIES_COMP)))) %>%\n  unnest(c(NUMBER_OF_TREES, SPECIES_DOM, STAND_HEIGHT)) %>%\n  as.data.frame() %>%\n  mutate_if(is.numeric, round, digits = 2) %>%\n  separate(SAMPLE_CODE, into = c(\"METEO_ID\", \"SPECIES_SHORT\"), sep = \"_\", remove=FALSE) %>%\n  dplyr::select(SAMPLE_CODE, METEO_ID, SPECIES_SHORT, SPECIES_DOM, STAND_HEIGHT, NUMBER_OF_TREES)\n```\n\n### Distributions and correlations\n\n```{r fig-edge-distance-distribution, include=TRUE, fig.cap=\"Edge distance distribution by tree species.\"}\nggplot(data=sample_data, aes(x=SPECIES_TREE, y=EDGE_DIST))+\n  geom_violin()+\n  geom_jitter(width = 0.1)+\n  ylab(\"Edge distance (m)\") +\n  xlab(\"Tree species\")+\n  theme_report()\n```\n\n```{r fig-competition-distribution, fig.cap=\"Competition index distribution by tree species.\"}\ncompetition_plot <- competition  %>%\n  pivot_longer(cols=c(SPECIES_DOM, STAND_HEIGHT, NUMBER_OF_TREES), names_to = \"PARAMETER\", values_to = \"COMPETITION\")\n\nggplot()+\n  geom_violin(data=competition_plot, aes(x=SPECIES_SHORT, y=COMPETITION))+\n  geom_jitter(data=competition_plot, aes(x=SPECIES_SHORT, y=COMPETITION), width = 0.1)+\n  facet_wrap(~PARAMETER, scales=\"free_y\")+\n  ylab(\"Competition parameter\") +\n  xlab(\"Tree species\")+\n  theme_report()\n```\n\n```{r fig-competition-correlation, progress=FALSE, fig.cap=\"Correlation between different competition measures.\"}\npairs_competition <- competition %>% select(-SAMPLE_CODE, -SPECIES_SHORT, -METEO_ID)\nggpairs(pairs_competition, showStrips=TRUE, progress=FALSE)+\n  theme_report(angle=90)\n```\n\n```{r save-output}\nsaveRDS(competition %>% ungroup(), paste0(path_own_data, \"/input_competition.rds\"))\n```\n","srcMarkdownNoYaml":"\n\n# Stand structure\n\n```{r}\nlocation <- paste0(getwd())\nsource(paste0(\"../00_helpers/setup.R\")) #common libraries and custom functions\nsource(paste0(\"../00_helpers/species_and_phases.R\"))\nsample_data <- readRDS(paste0(path_own_data, \"/sample_data.rds\"))\nsample_comp <- readRDS(paste0(path_own_data, \"/sample_competition.rds\"))\n```\n\n## Data collection\n\nAll tree height, distance to observation tree and distance to forest edge were measured as horizontal distance with a\nHaglöf Vertex IV.\n\n## Competition\n\nAll trees within a radius of 10m from the center tree and a DBH \\>=14cm\nwhere considered as competitors. Some observation trees were very thin (see @tbl-competition-special-cases) in which case all competitors that were of the same diameter as the observation tree were recorded as well.\nSample plots where often not entirely within the forest,\nbecause the sample tree stood at the forest edge or close to a forest\nroad. Furthermore, often groups of trees instead of individual trees\nwere observed. Also, information given by the observers indicated a\nlot of intervention, e.g. clean up of wind throws or harvesting, in recent years that I was unable to assess\nsystematically. The Hegyi and Schroeder competition index as well as basal area were calculated, but their values are mathematically flawed and misleading. Therefore, we only used social situation and edge distance to account for stand climate.\n\n```{r tbl-competition-special-cases}\n# tbl-cap: SPN trees with small (<20 cm) or very small (<14 cm) diameters.\ntable <- sample_data %>% \n  filter(DBH_single <=20) %>%\n  select(METEO_ID, SPECIES_TREE, DBH_single) %>%\n  arrange(DBH_single) %>%\n  datatable(rownames = FALSE, options = list(scrollX = FALSE, pageLength = 5))\ntable\n```\n\n## Edge distance\n\nEdge distance was measured as distance from trunk of the observation tree to crown edge at the forest edge. Trees outside of the forest were assigned an edge distance of -5m. Trees\nthat exceeded the measuring distance of the vertex (approximately > 45m)\nwere assigned 50m. These special cases were flagged with a variable indicating a measurement or an imputed\nvalue. This would ensure that trees with imputed values have separate\nslopes and do not pull the slope of actually measured trees. E.g.\ndoy \\~ edge_distance * edge_distance_imputed + topography +\nelevation.\n\n```{r competition-all, filename=\"Calculation of competition parameters.\", include=TRUE, echo=TRUE}\n#| code-fold: true\n\ncompetition <- sample_comp %>%\n  full_join(sample_data %>% select(SAMPLE_CODE, OBSERVATION_TYPE), by=c(\"SAMPLE_CODE\")) %>% \n  group_by(SAMPLE_CODE, OBSERVATION_TYPE) %>%\n  nest() %>%\n  ungroup() %>% \n  as.data.frame() %>%\n  mutate(NUMBER_OF_TREES = map(data, ~.x %>%\n                                 summarise(NUMBER_OF_TREES = n())),\n         STAND_HEIGHT = map(data, ~.x %>%\n                       arrange(desc(HEIGHT)) %>%\n                       slice_head(n=3) %>% \n                       summarise(STAND_HEIGHT=mean(HEIGHT)) %>% \n                       mutate(STAND_HEIGHT=case_when(is.na(STAND_HEIGHT) ~ 0,\n                                                     TRUE ~ STAND_HEIGHT)))) %>%\n  #NUMBER OF DOMINANT SPECIES\n  mutate(SPECIES_DOM = map(data, ~.x %>%\n                      arrange(desc(HEIGHT)) %>%\n                      slice_head(n=5) %>%\n                      summarise(SPECIES_DOM=n_distinct(SPECIES_COMP)))) %>%\n  unnest(c(NUMBER_OF_TREES, SPECIES_DOM, STAND_HEIGHT)) %>%\n  as.data.frame() %>%\n  mutate_if(is.numeric, round, digits = 2) %>%\n  separate(SAMPLE_CODE, into = c(\"METEO_ID\", \"SPECIES_SHORT\"), sep = \"_\", remove=FALSE) %>%\n  dplyr::select(SAMPLE_CODE, METEO_ID, SPECIES_SHORT, SPECIES_DOM, STAND_HEIGHT, NUMBER_OF_TREES)\n```\n\n### Distributions and correlations\n\n```{r fig-edge-distance-distribution, include=TRUE, fig.cap=\"Edge distance distribution by tree species.\"}\nggplot(data=sample_data, aes(x=SPECIES_TREE, y=EDGE_DIST))+\n  geom_violin()+\n  geom_jitter(width = 0.1)+\n  ylab(\"Edge distance (m)\") +\n  xlab(\"Tree species\")+\n  theme_report()\n```\n\n```{r fig-competition-distribution, fig.cap=\"Competition index distribution by tree species.\"}\ncompetition_plot <- competition  %>%\n  pivot_longer(cols=c(SPECIES_DOM, STAND_HEIGHT, NUMBER_OF_TREES), names_to = \"PARAMETER\", values_to = \"COMPETITION\")\n\nggplot()+\n  geom_violin(data=competition_plot, aes(x=SPECIES_SHORT, y=COMPETITION))+\n  geom_jitter(data=competition_plot, aes(x=SPECIES_SHORT, y=COMPETITION), width = 0.1)+\n  facet_wrap(~PARAMETER, scales=\"free_y\")+\n  ylab(\"Competition parameter\") +\n  xlab(\"Tree species\")+\n  theme_report()\n```\n\n```{r fig-competition-correlation, progress=FALSE, fig.cap=\"Correlation between different competition measures.\"}\npairs_competition <- competition %>% select(-SAMPLE_CODE, -SPECIES_SHORT, -METEO_ID)\nggpairs(pairs_competition, showStrips=TRUE, progress=FALSE)+\n  theme_report(angle=90)\n```\n\n```{r save-output}\nsaveRDS(competition %>% ungroup(), paste0(path_own_data, \"/input_competition.rds\"))\n```\n"},"formats":{"html":{"identifier":{"display-name":"HTML","target-format":"html","base-format":"html"},"execute":{"fig-width":8,"fig-height":4,"fig-format":"retina","fig-dpi":96,"df-print":"paged","error":false,"eval":true,"cache":null,"freeze":true,"echo":false,"output":true,"warning":false,"include":true,"keep-md":false,"keep-ipynb":false,"ipynb":null,"enabled":null,"daemon":null,"daemon-restart":false,"debug":false,"ipynb-filters":[],"ipynb-shell-interactivity":null,"plotly-connected":true,"message":false,"engine":"knitr"},"render":{"keep-tex":false,"keep-typ":false,"keep-source":false,"keep-hidden":false,"prefer-html":false,"output-divs":true,"output-ext":"html","fig-align":"default","fig-pos":null,"fig-env":null,"code-fold":true,"code-overflow":"wrap","code-link":false,"code-line-numbers":true,"code-tools":false,"tbl-colwidths":"auto","merge-includes":true,"inline-includes":false,"preserve-yaml":false,"latex-auto-mk":true,"latex-auto-install":true,"latex-clean":true,"latex-min-runs":1,"latex-max-runs":10,"latex-makeindex":"makeindex","latex-makeindex-opts":[],"latex-tlmgr-opts":[],"latex-input-paths":[],"latex-output-dir":null,"link-external-icon":false,"link-external-newwindow":false,"self-contained-math":false,"format-resources":[],"notebook-links":true},"pandoc":{"standalone":true,"wrap":"none","default-image-extension":"png","to":"html","highlight-style":"espresso","toc":true,"toc-depth":3,"include-in-header":{"text":"<script type=\"text/javascript\" src=\"C:/Users/iostovary/Documents/Data/00_helpers/zoom.js\"></script>"},"output-file":"1_stand_structure.html"},"language":{"toc-title-document":"Table of contents","toc-title-website":"On this page","related-formats-title":"Other Formats","related-notebooks-title":"Notebooks","source-notebooks-prefix":"Source","other-links-title":"Other Links","code-links-title":"Code Links","launch-dev-container-title":"Launch Dev Container","launch-binder-title":"Launch Binder","article-notebook-label":"Article Notebook","notebook-preview-download":"Download Notebook","notebook-preview-download-src":"Download Source","notebook-preview-back":"Back to Article","manuscript-meca-bundle":"MECA Bundle","section-title-abstract":"Abstract","section-title-appendices":"Appendices","section-title-footnotes":"Footnotes","section-title-references":"References","section-title-reuse":"Reuse","section-title-copyright":"Copyright","section-title-citation":"Citation","appendix-attribution-cite-as":"For attribution, please cite this work as:","appendix-attribution-bibtex":"BibTeX citation:","title-block-author-single":"Author","title-block-author-plural":"Authors","title-block-affiliation-single":"Affiliation","title-block-affiliation-plural":"Affiliations","title-block-published":"Published","title-block-modified":"Modified","title-block-keywords":"Keywords","callout-tip-title":"Tip","callout-note-title":"Note","callout-warning-title":"Warning","callout-important-title":"Important","callout-caution-title":"Caution","code-summary":"Code","code-tools-menu-caption":"Code","code-tools-show-all-code":"Show All Code","code-tools-hide-all-code":"Hide All Code","code-tools-view-source":"View Source","code-tools-source-code":"Source Code","tools-share":"Share","tools-download":"Download","code-line":"Line","code-lines":"Lines","copy-button-tooltip":"Copy to Clipboard","copy-button-tooltip-success":"Copied!","repo-action-links-edit":"Edit this page","repo-action-links-source":"View source","repo-action-links-issue":"Report an issue","back-to-top":"Back to top","search-no-results-text":"No results","search-matching-documents-text":"matching documents","search-copy-link-title":"Copy link to search","search-hide-matches-text":"Hide additional matches","search-more-match-text":"more match in this document","search-more-matches-text":"more matches in this document","search-clear-button-title":"Clear","search-text-placeholder":"","search-detached-cancel-button-title":"Cancel","search-submit-button-title":"Submit","search-label":"Search","toggle-section":"Toggle section","toggle-sidebar":"Toggle sidebar navigation","toggle-dark-mode":"Toggle dark mode","toggle-reader-mode":"Toggle reader mode","toggle-navigation":"Toggle navigation","crossref-fig-title":"Figure","crossref-tbl-title":"Table","crossref-lst-title":"Listing","crossref-thm-title":"Theorem","crossref-lem-title":"Lemma","crossref-cor-title":"Corollary","crossref-prp-title":"Proposition","crossref-cnj-title":"Conjecture","crossref-def-title":"Definition","crossref-exm-title":"Example","crossref-exr-title":"Exercise","crossref-ch-prefix":"Chapter","crossref-apx-prefix":"Appendix","crossref-sec-prefix":"Section","crossref-eq-prefix":"Equation","crossref-lof-title":"List of Figures","crossref-lot-title":"List of Tables","crossref-lol-title":"List of Listings","environment-proof-title":"Proof","environment-remark-title":"Remark","environment-solution-title":"Solution","listing-page-order-by":"Order By","listing-page-order-by-default":"Default","listing-page-order-by-date-asc":"Oldest","listing-page-order-by-date-desc":"Newest","listing-page-order-by-number-desc":"High to Low","listing-page-order-by-number-asc":"Low to High","listing-page-field-date":"Date","listing-page-field-title":"Title","listing-page-field-description":"Description","listing-page-field-author":"Author","listing-page-field-filename":"File Name","listing-page-field-filemodified":"Modified","listing-page-field-subtitle":"Subtitle","listing-page-field-readingtime":"Reading Time","listing-page-field-wordcount":"Word Count","listing-page-field-categories":"Categories","listing-page-minutes-compact":"{0} min","listing-page-category-all":"All","listing-page-no-matches":"No matching items","listing-page-words":"{0} words"},"metadata":{"lang":"en","fig-responsive":true,"quarto-version":"1.4.549","bibliography":["C:/Users/iostovary/Documents/Data/references.bib"],"csl":"C:/Users/iostovary/Documents/Data/citation_style_global-ecology-and-biogeography_mod_ostovary.csl","editor":{"markdown":{"wrap":72}},"page-layout":"full","code-summary":"Show the code","theme":"minty","code-folding":"hide","grid":{"body-width":"1100px"},"toc-location":"right","toc-float":{"collapsed":false,"number-sections":true},"editor_options":{"chunk_output_type":"inline"}},"extensions":{"book":{"multiFile":true}}}},"projectFormats":["html"]}